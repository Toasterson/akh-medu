# Phase 13e — Personal Task & Project Management

**Status**: Complete
**Date**: 2026-02-21
**Depends on**: Phase 13d (structured email extraction)

## Goal

Add a PIM (Personal Information Management) framework to the agent: GTD workflow
for task state management, Eisenhower matrix for priority classification, PARA
categorization, task dependency DAGs with cycle detection, recurring tasks, VSA
priority encoding, and CLI commands. PIM tasks are an **overlay on existing Goals**
via `PimMetadata`, not a separate entity type.

## Design

### PIM as Goal Overlay

Rather than creating a separate task entity, PIM metadata annotates existing `Goal`
entries via KG predicates in the `pim:` namespace. `PimMetadata` adds GTD state,
Eisenhower quadrant, PARA category, contexts, energy level, recurrence, and deadlines
to existing goals. This keeps the agent's attention unified between internal goals
and user tasks.

### GTD Workflow

Six states: Inbox, Next, Waiting, Someday, Reference, Done. Valid transitions are
enforced at the type level via `GtdState::can_transition_to()`. Weekly review
surfaces stale inbox items, stalled projects, and overdue tasks.

### Eisenhower Matrix

Four quadrants (Do, Schedule, Delegate, Eliminate) classified from urgency/importance
scores (0.0-1.0) with configurable thresholds. Each quadrant has a priority bonus
that feeds into the agent's goal priority system.

### Dependency DAG

Petgraph `DiGraph<SymbolId, DependencyEdge>` with cycle detection via DFS. Supports
topological ordering (Kahn's algorithm) and critical path analysis. Custom
`SerializableDag` handles serde since petgraph types don't implement Serialize.

### VSA Priority Encoding

Six role vectors (urgency, importance, energy, context, deadline_proximity, gtd_state)
encoded via `encode_token(ops, "pim-role:X")`. Priority profiles are encoded as
role-filler bundles for Hamming-based similarity search across tasks.

## Implementation

### New: `src/agent/pim.rs`

- `PimError` diagnostic enum (5 variants) with `PimResult<T>`
- `GtdState`, `EisenhowerQuadrant`, `ParaCategory`, `PimContext`, `EnergyLevel`,
  `Recurrence` enums — all with Display, Serialize, as_label/from_label
- `PimMetadata` struct (14 fields) — the per-goal overlay
- `PimPredicates` (14 KG relations in `pim:` namespace)
- `PimRoleVectors` (6 deterministic VSA role vectors)
- `PimManager` — HashMap-based metadata store + petgraph DAG + predicates + roles
- `SerializableDag` — custom serde bridge for petgraph DiGraph
- `GtdReviewResult` + `gtd_weekly_review()` — weekly review analysis
- `action_items_to_pim_tasks()` — bridge from Phase 13d ActionItemGoalSpec
- ~30 unit tests

### Modified

- `src/provenance.rs` — `PimTaskManaged` variant (tag 53)
- `src/agent/error.rs` — `Pim` transparent variant
- `src/agent/mod.rs` — `pub mod pim` + re-exports
- `src/agent/agent.rs` — `pim_manager` field, init/resume/persist, accessors
- `src/agent/explain.rs` — derivation_kind_prose arm
- `src/agent/reflect.rs` — `gtd_review` field, extended `reflect()` signature
- `src/agent/nlp.rs` — `PimCommand` variant + detection
- `src/main.rs` — `Commands::Pim`, `PimAction` enum (9 subcommands), handler
- `src/tui/mod.rs` — `PimCommand` match arm
- `src/reason/mod.rs` — `pim_rules()` (2 e-graph rewrite rules)

## Verification

- `cargo build` — passes
- `cargo build --features email` — passes
- `cargo test --lib` — 1160 tests pass (30+ new PIM tests)
- `cargo test --lib --features email` — 1308 tests pass (no regressions)
